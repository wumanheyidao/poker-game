<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10 äººåœ¨çº¿å¾·å·æ‰‘å…‹</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { 
            margin: 0; 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); 
            font-family: 'Arial', sans-serif; 
            overflow: hidden;
            min-height: 100vh;
        }
        
        /* æ¸¸æˆæ¡Œ */
        .poker-table {
            width: 800px; 
            height: 400px;
            background: radial-gradient(ellipse at center, #27ae60 0%, #1e8449 100%);
            border: 20px solid #5d4037;
            border-radius: 200px;
            position: absolute;
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 50px rgba(0,0,0,0.5), inset 0 0 100px rgba(0,0,0,0.3);
        }

        /* å…¬å…±ç‰ŒåŒºåŸŸ */
        .community-area {
            position: absolute;
            top: 50%; 
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex; 
            gap: 10px;
            min-height: 70px;
            min-width: 250px;
            justify-content: center;
            align-items: center;
        }

        /* åº•æ± ä¿¡æ¯ */
        .pot-info {
            position: absolute;
            top: 35%; 
            left: 50%;
            transform: translate(-50%, -50%);
            color: #f1c40f; 
            font-weight: bold; 
            font-size: 20px;
            background: rgba(0,0,0,0.5); 
            padding: 8px 25px; 
            border-radius: 25px;
            border: 2px solid #f1c40f;
        }

        /* æ¸¸æˆé˜¶æ®µæ˜¾ç¤º */
        .stage-info {
            position: absolute;
            top: 25%; 
            left: 50%;
            transform: translate(-50%, -50%);
            color: white; 
            font-size: 16px;
            background: rgba(0,0,0,0.3); 
            padding: 5px 15px; 
            border-radius: 15px;
        }

        /* ç©å®¶åº§ä½ */
        .seat {
            position: absolute;
            width: 110px; 
            height: 110px;
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            color: white;
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center;
            font-size: 12px;
            border: 3px solid #444;
            transition: all 0.3s;
            cursor: default;
        }
        
        .seat.active-turn { 
            border-color: #f1c40f; 
            box-shadow: 0 0 20px #f1c40f;
            transform: scale(1.05);
        }
        
        .seat.folded { opacity: 0.4; }
        .seat .chips { color: #f1c40f; font-weight: bold; font-size: 14px; }
        .seat .name { margin-bottom: 5px; font-weight: bold; }
        .seat .badges { font-size: 10px; color: #aaa; }

        /* 10 äººåº§ä½ä½ç½® (æ¤­åœ†å½¢åˆ†å¸ƒ) */
        .seat-0 { bottom: -70px; left: 50%; transform: translateX(-50%); }
        .seat-1 { bottom: 10px; left: -90px; }
        .seat-2 { top: 80px; left: -110px; }
        .seat-3 { top: 160px; left: -70px; }
        .seat-4 { top: 200px; left: 80px; }
        .seat-5 { top: 200px; right: 80px; }
        .seat-6 { top: 160px; right: -70px; }
        .seat-7 { top: 80px; right: -110px; }
        .seat-8 { bottom: 10px; right: -90px; }
        .seat-9 { bottom: -70px; left: 50%; transform: translateX(-50%); display: none; }

        /* æ‰‘å…‹ç‰Œæ ·å¼ */
        .card {
            width: 45px; 
            height: 65px;
            background: white; 
            border-radius: 6px;
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-size: 22px; 
            font-weight: bold;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.4);
            user-select: none;
        }
        .card.red { color: #e74c3c; }
        .card.black { color: #2c3e50; }
        .card.back {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            background-image: repeating-linear-gradient(45deg, #2c3e50 0, #2c3e50 3px, #34495e 3px, #34495e 6px);
            color: transparent;
            border: 2px solid #fff;
        }
        .hand-cards { 
            display: flex; 
            gap: 5px; 
            margin-top: 5px; 
        }

        /* æ§åˆ¶æ  */
        .controls {
            position: absolute; 
            bottom: 30px; 
            left: 50%;
            transform: translateX(-50%);
            display: flex; 
            gap: 15px;
            z-index: 100;
        }
        
        button {
            padding: 12px 30px; 
            font-size: 16px; 
            cursor: pointer;
            border: none; 
            border-radius: 8px; 
            color: white;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 10px rgba(0,0,0,0.4); }
        button:active:not(:disabled) { transform: translateY(0); }
        button:disabled { 
            background: #555 !important; 
            cursor: not-allowed; 
            opacity: 0.6;
        }
        
        button.fold { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }
        button.check { background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%); }
        button.raise { background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); }

        /* ç™»å½•é®ç½© */
        #login-modal {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex; 
            justify-content: center; 
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%); 
            padding: 40px; 
            border-radius: 15px; 
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 2px solid #34495e;
        }
        
        .modal-content h2 { 
            color: #f1c40f; 
            margin-top: 0;
            font-size: 28px;
        }
        
        input { 
            padding: 12px 20px; 
            font-size: 16px; 
            margin: 10px 0; 
            border-radius: 8px;
            border: 2px solid #34495e;
            background: #1a252f;
            color: white;
            width: 250px;
            text-align: center;
        }
        
        input:focus { 
            outline: none; 
            border-color: #f1c40f;
        }
        
        .modal-content button {
            background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);
            margin-top: 15px;
            width: 250px;
        }

        /* æ¶ˆæ¯æç¤º */
        #message-area {
            position: absolute; 
            top: 30px; 
            left: 50%; 
            transform: translateX(-50%);
            color: #f1c40f; 
            font-size: 26px; 
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            z-index: 200;
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
        }

        /* æˆ¿é—´ä¿¡æ¯æ˜¾ç¤º */
        .room-info {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #aaa;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div id="login-modal">
        <div class="modal-content">
            <h2>ğŸƒ å¾·å·æ‰‘å…‹</h2>
            <p style="color: #aaa; margin-bottom: 20px;">10 äººåœ¨çº¿å¯¹æˆ˜</p>
            <input type="text" id="room-id" placeholder="æˆ¿é—´å· (å’Œæœ‹å‹å¡«ä¸€æ ·)" value="friend888">
            <br>
            <input type="text" id="username" placeholder="ä½ çš„æ˜µç§°" value="Player">
            <br>
            <button onclick="joinGame()">ğŸ® åŠ å…¥æ¸¸æˆ</button>
        </div>
    </div>

    <!-- æ¶ˆæ¯æç¤º -->
    <div id="message-area"></div>

    <!-- æˆ¿é—´ä¿¡æ¯ -->
    <div class="room-info">æˆ¿é—´ï¼š<span id="room-display">-</span></div>

    <!-- æ¸¸æˆæ¡Œ -->
    <div class="poker-table">
        <div class="stage-info">é˜¶æ®µï¼š<span id="stage-display">ç­‰å¾…ä¸­</span></div>
        <div class="pot-info">ğŸ’° åº•æ± ï¼š$<span id="pot-amount">0</span></div>
        <div class="community-area" id="community-cards"></div>
        <div id="seats-container"></div>
    </div>

    <!-- æ“ä½œæŒ‰é’® -->
    <div class="controls">
        <button class="fold" id="btn-fold" onclick="sendAction('fold')" disabled>ğŸš« å¼ƒç‰Œ</button>
        <button class="check" id="btn-check" onclick="sendAction('check')" disabled>âœ“ è¿‡ç‰Œ/è·Ÿæ³¨</button>
        <button class="raise" id="btn-raise" onclick="sendAction('raise')" disabled>ğŸ“ˆ åŠ æ³¨</button>
    </div>

    <script>
        let socket = null;
        let myId = null;
        let gameState = null;
        let currentRoom = '';

        const suitMap = { 's': 'â™ ', 'h': 'â™¥', 'c': 'â™£', 'd': 'â™¦' };
        const colorMap = { 's': 'black', 'h': 'red', 'c': 'black', 'd': 'red' };
        const stageMap = {
            'waiting': 'ç­‰å¾…ç©å®¶',
            'preflop': 'å‘åº•ç‰Œ',
            'flop': 'ç¿»ç‰Œ (3 å¼ )',
            'turn': 'è½¬ç‰Œ (4 å¼ )',
            'river': 'æ²³ç‰Œ (5 å¼ )',
            'showdown': 'æ‘Šç‰Œæ¯”ç‰Œ'
        };

        function joinGame() {
            const name = document.getElementById('username').value.trim();
            const roomId = document.getElementById('room-id').value.trim() || 'room1';
            
            if (!name) return alert('è¯·è¾“å…¥æ˜µç§°ï¼');
            
            currentRoom = roomId;
            document.getElementById('room-display').innerText = roomId;
            document.getElementById('login-modal').style.display = 'none';
            
            // è¿æ¥æœåŠ¡å™¨
            socket = io(window.location.origin, {
                query: { roomId: roomId }
            });
            
            bindSocketEvents(socket);
            socket.emit('join_game', name);
        }

        function bindSocketEvents(socket) {
            socket.on('connect', () => {
                myId = socket.id;
                console.log('å·²è¿æ¥åˆ°æœåŠ¡å™¨ï¼ŒID:', myId);
            });

            socket.on('game_state', (state) => {
                gameState = state;
                renderTable(state);
            });

            socket.on('your_turn', () => {
                enableControls(true);
                showMessage('ğŸ¯ è½®åˆ°ä½ äº†ï¼');
            });

            socket.on('game_result', (data) => {
                showMessage('ğŸ† ' + data.msg + (data.handName ? ` (${data.handName})` : ''));
                enableControls(false);
            });
            
            window.gameSocket = socket;
        }

        function sendAction(action) {
            if(window.gameSocket) {
                window.gameSocket.emit('action', action);
                enableControls(false);
            }
        }

        function enableControls(enable) {
            document.getElementById('btn-fold').disabled = !enable;
            document.getElementById('btn-check').disabled = !enable;
            document.getElementById('btn-raise').disabled = !enable;
        }

        function showMessage(msg) {
            const el = document.getElementById('message-area');
            el.innerText = msg;
            setTimeout(() => el.innerText = '', 4000);
        }

        function renderTable(state) {
            document.getElementById('pot-amount').innerText = state.pot;
            document.getElementById('stage-display').innerText = stageMap[state.stage] || state.stage;
            renderCommunityCards(state.communityCards);
            renderSeats(state.players, state.currentTurnIdx, state.dealerIdx);
        }

        function renderCommunityCards(cards) {
            const container = document.getElementById('community-cards');
            container.innerHTML = '';
            cards.forEach(c => {
                container.appendChild(createCardEl(c));
            });
        }

        function renderSeats(players, turnIdx, dealerIdx) {
            const container = document.getElementById('seats-container');
            container.innerHTML = '';
            
            players.forEach((p, index) => {
                const seat = document.createElement('div');
                seat.className = `seat seat-${index % 10}`;
                
                if (index === turnIdx) seat.classList.add('active-turn');
                if (p.status === 'folded') seat.classList.add('folded');
                if (p.status === 'sitout') seat.style.opacity = '0.3';

                let badges = '';
                if (p.isDealer) badges += 'ğŸ“åº„å®¶ ';
                if (p.isSmallBlind) badges += 'SB ';
                if (p.isBigBlind) badges += 'BB ';

                let handHtml = '<div class="hand-cards">';
                if (p.status !== 'sitout') {
                    const showHand = (p.id === myId || gameState.stage === 'showdown');
                    if (showHand && p.hand && p.hand.length > 0) {
                        p.hand.forEach(c => handHtml += createCardEl(c).outerHTML);
                    } else if (p.status === 'active') {
                        handHtml += `<div class="card back"></div><div class="card back"></div>`;
                    }
                }
                handHtml += '</div>';

                seat.innerHTML = `
                    <div class="name">${p.name}</div>
                    <div class="badges">${badges}</div>
                    <div class="chips">ğŸ’µ $${p.chips}</div>
                    ${handHtml}
                `;
                container.appendChild(seat);
            });
        }

        function createCardEl(c) {
            const div = document.createElement('div');
            div.className = `card ${colorMap[c.suit]}`;
            div.innerText = `${c.value}${suitMap[c.suit]}`;
            return div;
        }
    </script>
</body>
</html>